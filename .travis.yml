language: cpp

branches:
    only:
        - master
        - release

compiler:
    - gcc

addons:
    apt_packages:
        - lib32bz2-1.0
        - lib32ncurses5
        - lib32z1 
    apt:
        sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-precise 
        packages:
            - gcc-7
            - g++-7
        
     

before_script:
    - wget https://developer.arm.com/-/media/Files/downloads/gnu-rm/8-2018q4/gcc-arm-none-eabi-8-2018-q4-major-linux.tar.bz2? -O /tmp/gcc-arm-none-eabi.tar.bz2
    - tar -xvjf /tmp/gcc-arm-none-eabi.tar.bz2
    - export PATH=$PATH:$PWD/gcc-arm-none-eabi-8-2018-q4-major/bin/ 

install:
    - cd ..
    - git clone https://github.com/R2D2-2019/R2D2-build.git 
    - sudo unlink /usr/bin/gcc && sudo ln -s /usr/bin/gcc-7 /usr/bin/gcc # Change symlinks of gcc to gcc-5
    - sudo unlink /usr/bin/g++ && sudo ln -s /usr/bin/g++-7 /usr/bin/g++
    
script:
    - g++ -v
    - arm-none-eabi-g++ -v
    - cd R2D2-build/modules
    - echo $TRAVIS_BUILD_DIR
    - cp -r $TRAVIS_BUILD_DIR $PWD/test_module
    - ls
    - cd test_module/test
    - ls
    - make build 
    - make clean